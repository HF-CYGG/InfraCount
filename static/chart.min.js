(()=>{function r(e){return Math.max(...e.flat())||1}function p(e,t){const n=e.getContext("2d");return{n,w:e.width,h:e.height,c:n,m:40}}function d(e,t){const{w,h,c,m}=p(e),a=h-m*2,o=w-m*2;c.clearRect(0,0,w,h);c.fillStyle="#fff";c.fillRect(0,0,w,h);c.strokeStyle="#ddd";c.strokeRect(0,0,w,h);c.translate(m,m);return{w:o,h:a,c}}function f(e){const t=e.data.labels.length,n=e.data.datasets.map(s=>s.data),o=r(n),i=e.ctx,h=e.h,u=e.w,c=(l)=>Math.round((l/o)* (h-20)),y=(l)=>Math.round((u/(t-1))*l);return{t,n,o,i,h,u,c,y}}class Chart{constructor(e,t){this.canvas=e.canvas||e;this.type=t.type;this.data=t.data;this.options=t.options||{};this._draw()}_draw(){const g=d(this.canvas,this.data);this.ctx=g.c;this.w=g.w;this.h=g.h;const {c,y}=f(this);this.ctx.strokeStyle="#999";this.ctx.beginPath();this.ctx.moveTo(0,this.h);this.ctx.lineTo(this.w,this.h);this.ctx.moveTo(0,0);this.ctx.lineTo(0,this.h);this.ctx.stroke();if(this.type==='line')this._line();else if(this.type==='bar')this._bar();this.ctx.resetTransform()}_line(){const {i,c,y}=f(this);const ds=this.data.datasets;i.lineWidth=2;ds.forEach((s,k)=>{i.strokeStyle=s.borderColor||'#2b8a3e';i.beginPath();s.data.forEach((v,idx)=>{const x=y(idx);const ty=f(this).c(v);const py=this.h-ty;if(idx===0)i.moveTo(x,py);else i.lineTo(x,py)});i.stroke()})}_bar(){const {i,c,y}=f(this);const ds=this.data.datasets;if(ds.length===0)return;const bars=ds[0].data;const bw=Math.max(4,Math.floor(this.w/(bars.length*1.5)));bars.forEach((v,idx)=>{const x=y(idx)-bw/2;const ty=f(this).c(v);const py=this.h-ty;i.fillStyle=(ds[0].backgroundColor||'#74c69d');i.fillRect(x,py,bw,ty)})}destroy(){const ctx=this.canvas.getContext('2d');ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}toDataURL(){return this.canvas.toDataURL('image/png')}}window.Chart=Chart})();
